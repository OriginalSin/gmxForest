var gmxForest=function(t){"use strict";function e(){}function a(t,e){for(var a in e)t[a]=e[a];return t}function n(t,e){for(var a in e)t[a]=1;return t}function s(t,e){return 0===e&&t(),function(){--e||t()}}function r(t,e){t.appendChild(e)}function o(t,e,a){t.insertBefore(e,a)}function l(t){t.parentNode.removeChild(t)}function i(t,e){for(var a=0;a<t.length;a+=1)t[a]&&t[a].d(e)}function c(t){return document.createElement(t)}function u(t){return document.createTextNode(t)}function d(){return document.createComment("")}function h(t,e,a){t.addEventListener(e,a,!1)}function m(t,e,a){t.removeEventListener(e,a,!1)}function v(t,e,a){t.setAttribute(e,a)}function g(t,e){t.data=""+e}function f(t,e){t._handlers=Object.create(null),t._bind=e._bind,t.options=e,t.root=e.root||t,t.store=e.store||t.root.store}function p(t){t()}function _(t){for(;t&&t.length;)t.shift()()}var y={destroy:function(t){this.destroy=e,this.fire("destroy"),this.set=e,this._fragment.d(!1!==t),this._fragment=null,this._state={}},get:function(){return this._state},fire:function(t,e){var a=t in this._handlers&&this._handlers[t].slice();if(a)for(var n=0;n<a.length;n+=1){var s=a[n];if(!s.__calling)try{s.__calling=!0,s.call(this,e)}finally{s.__calling=!1}}},on:function(t,e){var a=this._handlers[t]||(this._handlers[t]=[]);return a.push(e),{cancel:function(){var t=a.indexOf(e);~t&&a.splice(t,1)}}},set:function(t){this._set(a({},t)),this.root._lock||(this.root._lock=!0,_(this.root._beforecreate),_(this.root._oncreate),_(this.root._aftercreate),this.root._lock=!1)},_recompute:e,_set:function(t){var e=this._state,n={},s=!1;for(var r in t)this._differs(t[r],e[r])&&(n[r]=s=!0);s&&(this._state=a(a({},e),t),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(this.fire("state",{changed:n,current:this._state,previous:e}),this._fragment.p(n,this._state),this.fire("update",{changed:n,current:this._state,previous:e})))},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:function(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}};var x={sort:function(t){var e=this.get().sortType;this.set({sortType:"desc"===e?"asc":"desc",sortKey:t}),this.setCurrPage(1)},checkReverse:function(t){var e={},a=t.ctrlKey,n=t.target.checked;if(a||n){var s=this.get(),r=s.items,o=s.hashCols,l=s.checked,i=o.gmx_id;r.forEach(function(t){var n=t[i];a&&l[n]||(e[n]=!0)})}this.set({checked:e})},checkMe:function(t){var e=this.get().checked;e[t]?delete e[t]:e[t]=!0,this.set({checked:e})},sortMe:function(t,e,a,n){var s=a[e];return t.sort(function(t,e){var a=e[s],r=t[s];return(a<r?-1:a>r?1:0)*("desc"===n?-1:1)})},pageTo:function(t){var e=this.get().pageFrom;return this.set({pageCurr:t}),t=t<1?1:t>e?e:t,this.setCurrPage(t),t},viewItem:function(t){this.root.viewItem(t)},setCurrPage:function(t){var e=this.get(),a=e.items,n=e.hashCols,s=e.pageCurr,r=e.pagesize,o=e.sortKey,l=e.sortType,i=r*((t=t||s)-1),c=(o?this.sortMe(a,o,n,l):a).slice(i,i+r),u=a.length/r,d=Math.floor(u);this.set({tableItems:c,pageCurr:t,pageFrom:d+(u>d?1:0)})}};function k(t){var e=t.changed,a=t.current;t.previous;e.items&&a.items.length&&this.setCurrPage()}function b(t,e){var a,n,s,i,d,f,p,_,y,x,k,b,N,C=e.it[e.hashCols.gmx_id];return{c:function(){a=c("tr"),n=c("td"),s=c("input"),d=u("\r\n\t\t\t"),f=c("td"),p=c("span"),_=u(C),y=u("\r\n\t\t\t"),x=c("td"),k=c("span"),(N=c("span")).innerHTML='<svg class="svgIcon svelte-1jj6zh"><use xlink:href="#zoom-to-feature"></use></svg>',s._svelte={component:t,ctx:e},h(s,"change",I),s.checked=i=e.checked[e.it[e.hashCols.gmx_id]],v(s,"type","checkbox"),s.className="svelte-1jj6zh",n.className="c1 svelte-1jj6zh",f.className="c2 svelte-1jj6zh",k.className=b="status "+(e.it[e.hashCols.FRSTAT]>0?"checked":"")+" svelte-1jj6zh",N._svelte={component:t,ctx:e},h(N,"click",j),N.className="leaflet-gmx-iconSvg svgIcon svelte-1jj6zh",x.className="c3",a.className="item svelte-1jj6zh"},m:function(t,e){o(t,a,e),r(a,n),r(n,s),r(a,d),r(a,f),r(f,p),r(p,_),r(a,y),r(a,x),r(x,k),r(x,N)},p:function(t,e){s._svelte.ctx=e,(t.checked||t.tableItems||t.hashCols)&&i!==(i=e.checked[e.it[e.hashCols.gmx_id]])&&(s.checked=i),(t.tableItems||t.hashCols)&&C!==(C=e.it[e.hashCols.gmx_id])&&g(_,C),(t.tableItems||t.hashCols)&&b!==(b="status "+(e.it[e.hashCols.FRSTAT]>0?"checked":"")+" svelte-1jj6zh")&&(k.className=b),N._svelte.ctx=e},d:function(t){t&&l(a),m(s,"change",I),m(N,"click",j)}}}function N(t,e,a){var n=Object.create(t);return n.it=e[a],n.each_value=e,n.it_index=a,n}function I(t){var e=this._svelte,a=e.component,n=e.ctx;a.checkMe(n.it[n.hashCols.gmx_id])}function j(t){var e=this._svelte,a=e.component,n=e.ctx;a.viewItem(n.it[n.hashCols.gmx_id])}function C(t){var e=this;f(this,t),this._state=a({sortType:"desc",sortKey:"gmx_id",reverse:!1,pageCurr:1,pagesize:15,pageFrom:0,tableItems:[],items:[],hashCols:[]},t.data),this._intro=!!t.intro,this._handlers.state=[k],t.root||(this._oncreate=[]),k.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){var a,n,s,d,f,_,y,x,k,I,j,C,T,w,F,L,D,z,S,q,R,O,M,P,V,A,E,G,H;function K(e){t.checkReverse(e)}function W(e){t.sort("gmx_id")}function B(e){t.sort("FRSTAT")}for(var U=e.tableItems,J=[],Q=0;Q<U.length;Q+=1)J[Q]=b(t,N(e,U,Q));function X(a){t.pageTo(e.pageCurr-1)}function Y(e){t.pageTo(this.value)}function Z(a){t.pageTo(e.pageCurr+1)}return{c:function(){a=c("div"),n=c("table"),s=c("tr"),d=c("th"),f=c("input"),_=u("\r\n\t\t\t"),(y=c("th")).innerHTML="<span>Id</span>",k=u("\r\n\t\t\t"),(I=c("th")).innerHTML="<span>Статус</span>",C=u("\r\n");for(var t=0;t<J.length;t+=1)J[t].c();T=u("\r\n\t\t"),w=c("tr"),F=c("td"),(L=c("button")).textContent="назад",z=u("\r\n\t\t\t\t"),S=c("span"),q=u("Стр. "),R=c("input"),O=u(" из "),M=u(e.pageFrom),P=u("\r\n\t\t\t\t"),(V=c("button")).textContent="вперед",E=u("\r\n\t\t\t\t"),(G=c("div")).innerHTML='<div class="-loading-inner"></div>',h(f,"click",K),f.checked=e.reverse,v(f,"type","checkbox"),f.value="on",f.className="svelte-1jj6zh",d.className="c1 svelte-1jj6zh",h(y,"click",W),y.className=x="c2 sorting \r\n\t\t\t\t\t"+("gmx_id"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh",h(I,"click",B),I.className=j="c3 sorting \r\n\t\t\t\t\t"+("FRSTAT"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh",s.className="head svelte-1jj6zh",h(L,"click",X),L.disabled=D=1===e.pageCurr,h(R,"change",Y),v(R,"type","number"),R.value=e.pageCurr,R.className="svelte-1jj6zh",S.className="pageInfo svelte-1jj6zh",h(V,"click",Z),V.disabled=A=e.pageFrom===e.pageCurr,G.className="-loading",F.colSpan="3",F.className="svelte-1jj6zh",w.className="pagination svelte-1jj6zh",n.className="table svelte-1jj6zh",a.className="tableContect svelte-1jj6zh"},m:function(t,e){o(t,a,e),r(a,n),r(n,s),r(s,d),r(d,f),r(s,_),r(s,y),r(s,k),r(s,I),r(n,C);for(var l=0;l<J.length;l+=1)J[l].m(n,null);r(n,T),r(n,w),r(w,F),r(F,L),r(F,z),r(F,S),r(S,q),r(S,R),r(S,O),r(S,M),r(F,P),r(F,V),r(F,E),r(F,G),H=!0},p:function(a,s){if(e=s,a.reverse&&(f.checked=e.reverse),(a.sortKey||a.sortType)&&x!==(x="c2 sorting \r\n\t\t\t\t\t"+("gmx_id"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh")&&(y.className=x),(a.sortKey||a.sortType)&&j!==(j="c3 sorting \r\n\t\t\t\t\t"+("FRSTAT"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh")&&(I.className=j),a.checked||a.tableItems||a.hashCols){U=e.tableItems;for(var r=0;r<U.length;r+=1){var o=N(e,U,r);J[r]?J[r].p(a,o):(J[r]=b(t,o),J[r].c(),J[r].m(n,T))}for(;r<J.length;r+=1)J[r].d(1);J.length=U.length}a.pageCurr&&D!==(D=1===e.pageCurr)&&(L.disabled=D),a.pageCurr&&(R.value=e.pageCurr),a.pageFrom&&g(M,e.pageFrom),(a.pageFrom||a.pageCurr)&&A!==(A=e.pageFrom===e.pageCurr)&&(V.disabled=A)},i:function(t,e){H||this.m(t,e)},o:p,d:function(t){t&&l(a),m(f,"click",K),m(y,"click",W),m(I,"click",B),i(J,t),m(L,"click",X),m(R,"change",Y),m(V,"click",Z)}}}(this,this._state),this.root._oncreate.push(function(){e.fire("update",{changed:n({},e._state),current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),_(this._oncreate)),this._intro=!0}a(C.prototype,y),a(C.prototype,x);function T(t){var e=t.changed,a=t.current;t.previous;if(e.clicked)if(a.clicked){var n=this.get().cols;this.setSelection(n[0])}else{var s=this.get().value;this.setValue(s)}}function w(t,e){var a,n,s,i,d=e.it;return{c:function(){a=c("option"),n=u(d),a.__value=s=e.it,a.value=a.__value,a.selected=i=e.colName===e.it},m:function(t,e){o(t,a,e),r(a,n)},p:function(t,e){t.cols&&d!==(d=e.it)&&g(n,d),t.cols&&s!==(s=e.it)&&(a.__value=s),a.value=a.__value,(t.colName||t.cols)&&i!==(i=e.colName===e.it)&&(a.selected=i)},d:function(t){t&&l(a)}}}function F(t,e){for(var a,n=e.cols,s=[],r=0;r<n.length;r+=1)s[r]=w(0,z(e,n,r));function u(e){t.setSelection(this.options[this.selectedIndex].value)}return{c:function(){a=c("select");for(var t=0;t<s.length;t+=1)s[t].c();h(a,"change",u),a.name=e.key,a.className="gmx-sidebar-select-with-addon svelte-1amu9hw"},m:function(t,e){o(t,a,e);for(var n=0;n<s.length;n+=1)s[n].m(a,null)},p:function(t,e){if(t.cols||t.colName){n=e.cols;for(var r=0;r<n.length;r+=1){var o=z(e,n,r);s[r]?s[r].p(t,o):(s[r]=w(0,o),s[r].c(),s[r].m(a,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}t.key&&(a.name=e.key)},d:function(t){t&&l(a),i(s,t),m(a,"change",u)}}}function D(t,e){var a;function n(e){t.setValue(e.target.value)}return{c:function(){h(a=c("input"),"change",n),v(a,"type","text"),a.className="gmx-sidebar-input-with-addon svelte-1amu9hw",a.name=e.key,a.value=e.value},m:function(t,e){o(t,a,e)},p:function(t,e){t.key&&(a.name=e.key),t.value&&(a.value=e.value)},d:function(t){t&&l(a),m(a,"change",n)}}}function z(t,e,a){var n=Object.create(t);return n.it=e[a],n.each_value=e,n.it_index=a,n}function S(t){var e=this;f(this,t),this._state=a({title:"",value:"",colName:"",clicked:!1,cols:[]},t.data),this._intro=!!t.intro,this._handlers.state=[T],t.root||(this._oncreate=[]),T.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){var a,n,s,i,d,v,f,_,y;function x(t){return t.clicked?F:D}var k=x(e),b=k(t,e);function N(a){t.set({clicked:!e.clicked})}return{c:function(){a=c("div"),n=c("div"),s=u(e.title),i=u("\r\n\t"),d=c("div"),v=c("div"),b.c(),f=u("\r\n\t\t\t"),_=c("button"),n.className="gmx-sidebar-label svelte-1amu9hw",h(_,"click",N),_.className="gmx-addon-button svelte-1amu9hw",_.title="выбрать из таблицы атрибутов",a.className="gmx-sidebar-labeled-block svelte-1amu9hw"},m:function(t,e){o(t,a,e),r(a,n),r(n,s),r(a,i),r(a,d),r(d,v),b.m(v,null),r(v,f),r(v,_),y=!0},p:function(a,n){e=n,a.title&&g(s,e.title),k===(k=x(e))&&b?b.p(a,e):(b.d(1),(b=k(t,e)).c(),b.m(v,f))},i:function(t,e){y||this.m(t,e)},o:p,d:function(t){t&&l(a),b.d(),m(_,"click",N)}}}(this,this._state),this.root._oncreate.push(function(){(function(){var t=this.get().key,e=this.root.get().params[t];void 0===e.title&&(e.title=e.value),this.set(e)}).call(e),e.fire("update",{changed:n({},e._state),current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),_(this._oncreate)),this._intro=!0}a(S.prototype,y),a(S.prototype,{setSelection:function(t){var e=this.get().key;this.root.setField(e,{value:"",field:t})},setValue:function(t){var e=this.get().key;this.root.setField(e,{value:t,field:""})}});var q=window.serverBase||"//maps.kosmosnimki.ru/";var R={viewItem:function(t){for(var e=this.get(),a=e.map,n=e.layerItems,s=e.hashCols,r=0,o=n.length;r<o;r++){var l=n[r];if(t===l[s.gmx_id]){var i=l[s.geomixergeojson],c=L.gmxUtil.getGeometryBounds(i),u=L.latLngBounds([[c.min.y,c.min.x],[c.max.y,c.max.x]]);a.fitBounds(u);break}}},sendReport:function(){var t=this,e=this.get(),a=e.checked,n=e.layerItems,s=e.hashCols,r=e.params,o=e.layerID,l=[],i=[],c=[];return e.gmxMap.layers.forEach(function(t){if(t.getGmxProperties&&t._map){var e=t.getGmxProperties(),a=e.MetaProperties||{},n={layerId:e.name,type:"оптическая"};if(e.Temporal){var s=t.getDateInterval();s.beginDate&&(n.beginDate=s.beginDate.getTime()/1e3),s.endDate&&(n.endDate=s.endDate.getTime()/1e3)}a.type&&(n.type=a.type.Value),a.system&&(n.system=a.system.Value),a.resolution&&(n.resolution=a.resolution.Value),c.push(n)}}),n.forEach(function(e){var n=e[s.gmx_id];if(a[n]){var o={featureID:n};for(var u in r){var d=r[u],h=t.changedParams[u]||{};o[u]="string"==typeof h?h:h.field?e[s[h.field]]:h.value||d.value}o.satLayers=c,l.push(o),i.push({action:"update",id:n,properties:{FRSTAT:2}})}}),this.set({report:!0}),fetch(q+"Plugins/ForestReport/ForestReportImage",{method:"post",headers:{"Content-type":"application/x-www-form-urlencoded"},body:L.gmxUtil.getFormData({WrapStyle:"None",groupRequest:l}),mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(e){"ok"===e.Status&&t.chkTask(e.Result.TaskID).then(function(e){if("ok"===e.Status){var a=e.Result.Result.downloadFile;a.split("name=")[1];window.open(q+a,"_self"),t.modifyVectorObjects(o,i),t.set({report:!1})}}).catch(function(t){return console.log(t)})}).catch(function(t){return console.log(t)})},chkTask:function(t){return new Promise(function(e,a){var n=setInterval(function(){fetch(q+"AsyncTask.ashx?WrapStyle=None&TaskID="+t,{mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(t){var s=t.Result,r=s.Completed;s.ErrorInfo?(clearInterval(n),a(t)):r&&(clearInterval(n),e(t))})},2e3)})},modifyVectorObjects:function(t,e){var a={WrapStyle:"None",LayerName:t,Objects:JSON.stringify(e)};return fetch(q+"VectorLayer/ModifyVectorObjects.ashx?"+L.gmxUtil.getFormData(a),{mode:"cors",credentials:"include",headers:{Accept:"application/json"}}).then(function(t){return t.json()}).catch(function(t){return console.log(t)})},selectFeaturesWithDrawing:function(t,e){var a={WrapStyle:"None",layer:t,columns:'[{"Value":"[gmx_id]"}]',page:0,query:"STIntersects([gmx_geometry], GeometryFromGeoJson('"+JSON.stringify(e)+"', 4326))"};return fetch(q+"VectorLayer/Search.ashx?"+L.gmxUtil.getFormData(a),{mode:"cors",credentials:"include",headers:{Accept:"application/json"}}).then(function(t){return t.json()}).catch(function(t){return console.log(t)})},startDrawing:function(t){var e=this,a=this.get(),n=a.map,s=a.drawstart,r=a.layerID,o=a.checked;this.set({drawstart:!s}),s||(n.gmxDrawing.clear(),n.gmxDrawing.create("Polygon"),n.gmxDrawing.on("drawstop",function(t){e.set({drawstart:!1}),e.selectFeaturesWithDrawing(r,t.object.toGeoJSON().geometry).then(function(t){if("ok"===t.Status&&t.Result){var a=t.Result.values.reduce(function(t,e){return t[e]=!0,t},{});e.root.set({checked:L.extend(a,o)})}})},this),n._gmxEventsManager._drawstart=!0)},setField:function(t,e){this.changedParams[t]=e},setNodeField:function(t,e){var a,n=t.options?t.options[t.selectedIndex].value:t.value;this.setField(t.name,n),e&&this.set(((a={})[t.name]=n,a))},colsToHash:function(t){return t.reduce(function(t,e,a){return t[e]=a,t},{})},loadFeatures:function(t){var e=this;return fetch(q+"VectorLayer/Search.ashx?layer="+t+"&geometry=true&out_cs=EPSG:4326&WrapStyle=None",{mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(t){if("ok"===t.Status){var a=t.Result.fields;e.set({cols:a,hashCols:e.colsToHash(a),layerItems:t.Result.values})}}).catch(function(t){return console.log(t)})},getReportsCount:function(){var t=this;return fetch(q+"plugins/forestreport/rest/GetCurrentUserInfo?WrapStyle=None",{mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(e){if("ok"===e.Status){var a=e.Result.limit-e.Result.used;t.set({limit:a>0?a:0})}}).catch(function(t){return console.log(t)})},styleHook:function(t){return this.get().checked[t.id]?{strokeStyle:"#00ffff"}:{}}};function O(t){var e=t.changed,a=t.current;t.previous;if(e.layerID&&a.layerID){var n=this.get(),s=n.gmxMap;n.checked;this.currentLayer=s.layersByID[a.layerID],this.currentLayer&&this.currentLayer.setStyleHook(this.styleHook.bind(this)),this.loadFeatures(a.layerID)}e.checked&&this.currentLayer&&this.currentLayer.repaint()}function M(t,e){var a,n,s,i,d=e.it.title;return{c:function(){a=c("option"),n=u(d),a.__value=s=e.it.id,a.value=a.__value,a.selected=i=e.layerID===e.it.id,a.className="svelte-gt11xl"},m:function(t,e){o(t,a,e),r(a,n)},p:function(t,e){t.layerIds&&d!==(d=e.it.title)&&g(n,d),t.layerIds&&s!==(s=e.it.id)&&(a.__value=s),a.value=a.__value,(t.layerID||t.layerIds)&&i!==(i=e.layerID===e.it.id)&&(a.selected=i)},d:function(t){t&&l(a)}}}function P(t,e){for(var a,n=e.layerIds,s=[],r=0;r<n.length;r+=1)s[r]=M(0,B(e,n,r));return{c:function(){for(var t=0;t<s.length;t+=1)s[t].c();a=d()},m:function(t,e){for(var n=0;n<s.length;n+=1)s[n].m(t,e);o(t,a,e)},p:function(t,e){if(t.layerIds||t.layerID){n=e.layerIds;for(var r=0;r<n.length;r+=1){var o=B(e,n,r);s[r]?s[r].p(t,o):(s[r]=M(0,o),s[r].c(),s[r].m(a.parentNode,a))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d:function(t){i(s,t),t&&l(a)}}}function V(t,e){var a,n,s,i=e.it;return{c:function(){a=c("option"),n=u(i),a.__value=s=e.it,a.value=a.__value,a.className="svelte-gt11xl"},m:function(t,e){o(t,a,e),r(a,n)},p:function(t,e){t.params&&i!==(i=e.it)&&g(n,i),t.params&&s!==(s=e.it)&&(a.__value=s),a.value=a.__value},d:function(t){t&&l(a)}}}function A(t,e){var a,n,i,d={key:"fellingForm",cols:e.cols},h=new S({root:t.root,store:t.store,data:d}),m={key:"fellingType",cols:e.cols},v=new S({root:t.root,store:t.store,data:m});return{c:function(){a=c("div"),h._fragment.c(),n=u("\r\n\t\t\t\t\t\t"),v._fragment.c()},m:function(t,e){o(t,a,e),h._mount(a,null),r(a,n),v._mount(a,null),i=!0},p:function(t,e){var a={};t.cols&&(a.cols=e.cols),h._set(a);var n={};t.cols&&(n.cols=e.cols),v._set(n)},i:function(t,e){i||this.m(t,e)},o:function(t){i&&(t=s(t,2),h._fragment.o(t),v._fragment.o(t),i=!1)},d:function(t){t&&l(a),h.destroy(),v.destroy()}}}function E(t,e){var a,n,s,i,d=e.it.title;return{c:function(){a=c("option"),n=u(d),a.__value=s=e.it.id,a.value=a.__value,a.selected=i=e.quadrantLayerId===e.it.id,a.className="svelte-gt11xl"},m:function(t,e){o(t,a,e),r(a,n)},p:function(t,e){t.quadrantIds&&d!==(d=e.it.title)&&g(n,d),t.quadrantIds&&s!==(s=e.it.id)&&(a.__value=s),a.value=a.__value,(t.quadrantLayerId||t.quadrantIds)&&i!==(i=e.quadrantLayerId===e.it.id)&&(a.selected=i)},d:function(t){t&&l(a)}}}function G(t,e){for(var a,n=e.quadrantIds,s=[],r=0;r<n.length;r+=1)s[r]=E(0,J(e,n,r));return{c:function(){for(var t=0;t<s.length;t+=1)s[t].c();a=d()},m:function(t,e){for(var n=0;n<s.length;n+=1)s[n].m(t,e);o(t,a,e)},p:function(t,e){if(t.quadrantIds||t.quadrantLayerId){n=e.quadrantIds;for(var r=0;r<n.length;r+=1){var o=J(e,n,r);s[r]?s[r].p(t,o):(s[r]=E(0,o),s[r].c(),s[r].m(a.parentNode,a))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d:function(t){i(s,t),t&&l(a)}}}function H(t,a){var n;return{c:function(){(n=c("button")).innerHTML='<div class="lds-ellipsis svelte-gt11xl"><div class="svelte-gt11xl"></div><div class="svelte-gt11xl"></div><div class="svelte-gt11xl"></div><div class="svelte-gt11xl"></div></div>',n.className="gmx-sidebar-button-disabled svelte-gt11xl"},m:function(t,e){o(t,n,e)},p:e,d:function(t){t&&l(n)}}}function K(t,e){var a,n;function s(e){t.sendReport()}return{c:function(){(a=c("button")).textContent="Создать отчеты",h(a,"click",s),a.className=n="gmx-sidebar-button"+(e.Object.keys(e.checked).length?"":"-disabled")+" svelte-gt11xl"},m:function(t,e){o(t,a,e)},p:function(t,e){(t.Object||t.checked)&&n!==(n="gmx-sidebar-button"+(e.Object.keys(e.checked).length?"":"-disabled")+" svelte-gt11xl")&&(a.className=n)},d:function(t){t&&l(a),m(a,"click",s)}}}function W(t,e){for(var a,n,d,f,p,_,y,x,k,b,N,I,j,T,w,F,L,D,z,q,R,O,M,P,E,W,B,J,Q,X,Y,Z,$,tt,et,at,nt,st,rt,ot,lt,it,ct,ut,dt,ht,mt,vt,gt,ft,pt,_t,yt,xt,kt,bt,Nt,It,jt,Ct,Tt,wt,Ft,Lt,Dt,zt,St,qt,Rt,Ot,Mt,Pt,Vt,At,Et,Gt,Ht,Kt,Wt,Bt,Ut,Jt,Qt,Xt,Yt=e.params.reportType.title,Zt=e.params.organizationName.title||e.params.organizationName.value,$t=e.params.inn.title||e.params.inn.value,te=e.params.reportType.title,ee=e.params.quadrantLayerId.title||e.params.quadrantLayerId.value,ae=e.drawstart?"Полигон рисуется":"Выделите участки полигоном",ne=e.Object.keys(e.checked).length,se=e.layerItems.length,re={},oe=e.params.reportType.options,le=[],ie=0;ie<oe.length;ie+=1)le[ie]=V(0,U(e,oe,ie));function ce(e){t.setNodeField(this,!0)}var ue="о восстановлении лесов"!==e.reportType&&A(t,e);function de(e){t.setNodeField(this)}function he(e){t.setNodeField(this)}var me={key:"region",cols:e.cols},ve=new S({root:t.root,store:t.store,data:me}),ge={key:"forestry",cols:e.cols},fe=new S({root:t.root,store:t.store,data:ge}),pe={key:"sectionForestry",cols:e.cols},_e=new S({root:t.root,store:t.store,data:pe}),ye={key:"quadrant",cols:e.cols},xe=new S({root:t.root,store:t.store,data:ye}),ke={key:"stratum",cols:e.cols},be=new S({root:t.root,store:t.store,data:ke}),Ne={key:"site",cols:e.cols},Ie=new S({root:t.root,store:t.store,data:Ne}),je={key:"recoveryEventType",cols:e.cols},Ce=new S({root:t.root,store:t.store,data:je}),Te={key:"siteArea",cols:e.cols},we=new S({root:t.root,store:t.store,data:Te});function Fe(e){t.setNodeField(this,!0)}var Le=e.quadrantIds&&G(0,e);function De(e){t.setNodeField(this,!0)}function ze(e){t.startDrawing(e)}var Se={items:e.layerItems,hashCols:e.hashCols};void 0!==e.checked&&(Se.checked=e.checked,re.checked=!0);var qe=new C({root:t.root,store:t.store,data:Se,_bind:function(e,a){var n={};!re.checked&&e.checked&&(n.checked=a.checked),t._set(n),re={}}});function Re(t){return t.report?H:K}t.root._beforecreate.push(function(){qe._bind({checked:1},qe.get())});var Oe=Re(e),Me=Oe(t,e);return{c:function(){a=c("div"),(n=c("div")).textContent="Ввод информации",d=u("\r\n\t\t\t"),f=c("div"),p=c("div"),_=c("div"),y=c("div"),x=u(Yt),k=u("\r\n\t\t\t\t\t\t"),b=c("select");for(var t=0;t<le.length;t+=1)le[t].c();N=u("\r\n"),ue&&ue.c(),I=u("\r\n\t\t\t\t\t"),j=c("div"),T=c("div"),w=u(Zt),F=u("\r\n\t\t\t\t\t\t"),L=c("input"),z=u("\r\n\t\t\t\t\t"),q=c("div"),R=c("div"),O=u($t),M=u("\r\n\t\t\t\t\t\t"),P=c("input"),W=u("\r\n\r\n\t\t\t\t\t"),ve._fragment.c(),B=u("\r\n\t\t\t\t\t"),fe._fragment.c(),J=u("\r\n\t\t\t\t\t"),_e._fragment.c(),Q=u("\r\n\t\t\t\t\t"),xe._fragment.c(),X=u("\r\n\t\t\t\t\t"),be._fragment.c(),Y=u("\r\n\t\t\t\t\t"),Ie._fragment.c(),Z=u("\r\n\t\t\t\t\t"),Ce._fragment.c(),$=u("\r\n\t\t\t\t\t"),we._fragment.c(),tt=u("\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t\t"),et=c("div"),at=c("div"),nt=u(te),st=u("\r\n\t\t\t\t\t\t"),rt=c("select"),ot=c("option"),lt=u("1:5000"),it=c("option"),ct=u("1:10000"),ut=c("option"),dt=u("1:15000"),ht=c("option"),mt=u("1:20000"),vt=c("option"),gt=u("1:25000"),ft=c("option"),pt=u("1:30000"),_t=c("option"),yt=u("1:35000"),xt=c("option"),kt=u("1:40000"),bt=c("option"),Nt=u("1:45000"),It=c("option"),jt=u("1:50000"),Ct=u("\r\n\t\t\t\t\t"),Tt=c("div"),wt=c("div"),Ft=u(ee),Lt=u("\r\n\t\t\t\t\t\t"),Dt=c("select"),zt=c("option"),Le&&Le.c(),St=u("\r\n\t\t\t"),(qt=c("div")).textContent="Список объектов",Rt=u("\r\n\t\t\t"),Ot=c("div"),Mt=c("div"),Pt=c("div"),Vt=c("button"),At=u(ae),Et=u("\r\n\t\t\t\t\t"),Gt=c("div"),Ht=u("Выделено: "),Kt=u(ne),Wt=u(" / "),Bt=u(se),Ut=u("\r\n\t\t\t\t\t"),qe._fragment.c(),Jt=u("\r\n\t\t\t"),Qt=c("div"),Me.c(),n.className="gmx-sidebar-label-medium svelte-gt11xl",y.className="gmx-sidebar-label svelte-gt11xl",h(b,"change",ce),b.name="reportType",b.className="gmx-sidebar-select-large svelte-gt11xl",_.className="gmx-sidebar-labeled-block svelte-gt11xl",T.className="gmx-sidebar-label-small svelte-gt11xl",h(L,"change",de),L.name="organizationName",L.value=D=e.params.organizationName.value,v(L,"type","text"),L.className="gmx-sidebar-input-large svelte-gt11xl",j.className="gmx-sidebar-labeled-block svelte-gt11xl",R.className="gmx-sidebar-label-small svelte-gt11xl",h(P,"change",he),P.name="inn",P.value=E=e.params.inn.value,v(P,"type","text"),P.className="gmx-sidebar-input-large svelte-gt11xl",q.className="gmx-sidebar-labeled-block svelte-gt11xl",at.className="gmx-sidebar-label svelte-gt11xl",ot.__value="5000",ot.value=ot.__value,ot.className="svelte-gt11xl",it.__value="10000",it.value=it.__value,it.className="svelte-gt11xl",ut.__value="15000",ut.value=ut.__value,ut.className="svelte-gt11xl",ht.__value="20000",ht.value=ht.__value,ht.className="svelte-gt11xl",vt.__value="25000",vt.value=vt.__value,vt.className="svelte-gt11xl",ft.__value="30000",ft.value=ft.__value,ft.className="svelte-gt11xl",_t.__value="35000",_t.value=_t.__value,_t.className="svelte-gt11xl",xt.__value="40000",xt.value=xt.__value,xt.className="svelte-gt11xl",bt.__value="45000",bt.value=bt.__value,bt.className="svelte-gt11xl",It.__value="50000",It.value=It.__value,It.className="svelte-gt11xl",h(rt,"change",Fe),rt.name="scale",rt.className="gmx-sidebar-select-large svelte-gt11xl",et.className="gmx-sidebar-labeled-block svelte-gt11xl",wt.className="gmx-sidebar-label svelte-gt11xl",zt.__value="",zt.value=zt.__value,zt.className="svelte-gt11xl",h(Dt,"change",De),Dt.name="quadrantLayerId",Dt.className="gmx-sidebar-select-large svelte-gt11xl",Tt.className="gmx-sidebar-labeled-block svelte-gt11xl",qt.className="gmx-sidebar-label-medium svelte-gt11xl",h(Vt,"click",ze),Vt.className="gmx-sidebar-button svelte-gt11xl",Pt.className="gmx-geometry-select-container svelte-gt11xl",Gt.className="gmx-sidebar-label-medium svelte-gt11xl",Ot.className="forest-features-block svelte-gt11xl",Qt.className="gmx-button-container svelte-gt11xl",a.className="leftContent forest-plugin-content svelte-gt11xl"},m:function(t,e){o(t,a,e),r(a,n),r(a,d),r(a,f),r(f,p),r(p,_),r(_,y),r(y,x),r(_,k),r(_,b);for(var s=0;s<le.length;s+=1)le[s].m(b,null);r(p,N),ue&&ue.m(p,null),r(p,I),r(p,j),r(j,T),r(T,w),r(j,F),r(j,L),r(p,z),r(p,q),r(q,R),r(R,O),r(q,M),r(q,P),r(p,W),ve._mount(p,null),r(p,B),fe._mount(p,null),r(p,J),_e._mount(p,null),r(p,Q),xe._mount(p,null),r(p,X),be._mount(p,null),r(p,Y),Ie._mount(p,null),r(p,Z),Ce._mount(p,null),r(p,$),we._mount(p,null),r(p,tt),r(p,et),r(et,at),r(at,nt),r(et,st),r(et,rt),r(rt,ot),r(ot,lt),r(rt,it),r(it,ct),r(rt,ut),r(ut,dt),r(rt,ht),r(ht,mt),r(rt,vt),r(vt,gt),r(rt,ft),r(ft,pt),r(rt,_t),r(_t,yt),r(rt,xt),r(xt,kt),r(rt,bt),r(bt,Nt),r(rt,It),r(It,jt),r(p,Ct),r(p,Tt),r(Tt,wt),r(wt,Ft),r(Tt,Lt),r(Tt,Dt),r(Dt,zt),Le&&Le.m(Dt,null),r(a,St),r(a,qt),r(a,Rt),r(a,Ot),r(Ot,Mt),r(Mt,Pt),r(Pt,Vt),r(Vt,At),r(Mt,Et),r(Mt,Gt),r(Gt,Ht),r(Gt,Kt),r(Gt,Wt),r(Gt,Bt),r(Mt,Ut),qe._mount(Mt,null),r(a,Jt),r(a,Qt),Me.m(Qt,null),Xt=!0},p:function(a,n){if(e=n,Xt&&!a.params||Yt===(Yt=e.params.reportType.title)||g(x,Yt),a.params){oe=e.params.reportType.options;for(var s=0;s<oe.length;s+=1){var r=U(e,oe,s);le[s]?le[s].p(a,r):(le[s]=V(0,r),le[s].c(),le[s].m(b,null))}for(;s<le.length;s+=1)le[s].d(1);le.length=oe.length}"о восстановлении лесов"!==e.reportType?(ue?ue.p(a,e):(ue=A(t,e))&&ue.c(),ue.i(p,I)):ue&&ue.o(function(){ue.d(1),ue=null}),Xt&&!a.params||Zt===(Zt=e.params.organizationName.title||e.params.organizationName.value)||g(w,Zt),Xt&&!a.params||D===(D=e.params.organizationName.value)||(L.value=D),Xt&&!a.params||$t===($t=e.params.inn.title||e.params.inn.value)||g(O,$t),Xt&&!a.params||E===(E=e.params.inn.value)||(P.value=E);var o={};a.cols&&(o.cols=e.cols),ve._set(o);var l={};a.cols&&(l.cols=e.cols),fe._set(l);var i={};a.cols&&(i.cols=e.cols),_e._set(i);var c={};a.cols&&(c.cols=e.cols),xe._set(c);var u={};a.cols&&(u.cols=e.cols),be._set(u);var d={};a.cols&&(d.cols=e.cols),Ie._set(d);var h={};a.cols&&(h.cols=e.cols),Ce._set(h);var m={};a.cols&&(m.cols=e.cols),we._set(m),Xt&&!a.params||te===(te=e.params.reportType.title)||g(nt,te),Xt&&!a.params||ee===(ee=e.params.quadrantLayerId.title||e.params.quadrantLayerId.value)||g(Ft,ee),e.quadrantIds?Le?Le.p(a,e):((Le=G(0,e)).c(),Le.m(Dt,null)):Le&&(Le.d(1),Le=null),Xt&&!a.drawstart||ae===(ae=e.drawstart?"Полигон рисуется":"Выделите участки полигоном")||g(At,ae),Xt&&!a.Object&&!a.checked||ne===(ne=e.Object.keys(e.checked).length)||g(Kt,ne),Xt&&!a.layerItems||se===(se=e.layerItems.length)||g(Bt,se);var v={};a.layerItems&&(v.items=e.layerItems),a.hashCols&&(v.hashCols=e.hashCols),!re.checked&&a.checked&&(v.checked=e.checked,re.checked=void 0!==e.checked),qe._set(v),re={},Oe===(Oe=Re(e))&&Me?Me.p(a,e):(Me.d(1),(Me=Oe(t,e)).c(),Me.m(Qt,null))},i:function(t,e){Xt||this.m(t,e)},o:function(t){Xt&&(t=s(t,10),ue?ue.o(t):t(),ve._fragment.o(t),fe._fragment.o(t),_e._fragment.o(t),xe._fragment.o(t),be._fragment.o(t),Ie._fragment.o(t),Ce._fragment.o(t),we._fragment.o(t),qe._fragment.o(t),Xt=!1)},d:function(t){t&&l(a),i(le,t),m(b,"change",ce),ue&&ue.d(),m(L,"change",de),m(P,"change",he),ve.destroy(),fe.destroy(),_e.destroy(),xe.destroy(),be.destroy(),Ie.destroy(),Ce.destroy(),we.destroy(),m(rt,"change",Fe),Le&&Le.d(),m(Dt,"change",De),m(Vt,"click",ze),qe.destroy(),Me.d()}}}function B(t,e,a){var n=Object.create(t);return n.it=e[a],n.each_value=e,n.it_index=a,n}function U(t,e,a){var n=Object.create(t);return n.it=e[a],n.each_value_1=e,n.it_index_1=a,n}function J(t,e,a){var n=Object.create(t);return n.it=e[a],n.each_value_2=e,n.it_index_2=a,n}function Q(t){var e=this;f(this,t),this._state=a(a({Object:Object},{params:{layerID:{value:"",title:"Выбор слоя"},quadrantLayerId:{value:"",title:"Слой квартальной сети"},reportType:{value:"об использовании лесов",options:["об использовании лесов","о восстановлении лесов"],title:"Тип отчета"},organizationName:{value:"Наименование организации"},inn:{value:"1234567890",title:"ИНН"},region:{value:"Субъект",title:"Субъект Российской Федерации"},forestry:{value:"Лесничество"},sectionForestry:{value:"Участковое лесничество"},quadrant:{value:"Квартал"},stratum:{value:"Выдел"},fellingForm:{value:"",title:"Форма рубки"},fellingType:{value:"",title:"Тип рубки"},recoveryEventType:{value:"",title:"Тип мероприятия"},siteArea:{value:"Площадь"},scale:{value:"Масштаб"},site:{value:"Делянка"}},layerItems:[],limit:0,report:!1,drawstart:!1,layerID:"",quadrantLayerId:"",reportType:"",checked:{},layerIds:[],quadrantIds:[],hashCols:{},cols:[]}),t.data),this._intro=!!t.intro,this._handlers.state=[O],t.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),O.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){var a,n,s,i,d,v,f,p,_,y,x,k,b,N,I=e.layerIds&&P(0,e);function j(e){t.setNodeField(this,!0)}var C=e.layerID&&W(t,e);return{c:function(){a=c("div"),(n=c("div")).textContent="Отчет об использовании лесов",s=u("\r\n\t"),i=c("div"),d=u("Лимит отчетов: "),v=u(e.limit),f=u("\r\n\t"),p=c("div"),(_=c("span")).textContent="Выбор слоя",y=u("\r\n\t\t"),x=c("select"),k=c("option"),I&&I.c(),b=u("\r\n"),C&&C.c(),n.className="forest-plugin-header svelte-gt11xl",i.className="forest-plugin-header svelte-gt11xl",_.className="gmx-select-layer-container__label svelte-gt11xl",k.__value="",k.value=k.__value,k.className="svelte-gt11xl",h(x,"change",j),x.name="layerID",x.className="gmx-sidebar-select-medium svelte-gt11xl",p.className="gmx-select-layer-container svelte-gt11xl",a.className="forest-plugin-container svelte-gt11xl"},m:function(t,e){o(t,a,e),r(a,n),r(a,s),r(a,i),r(i,d),r(i,v),r(a,f),r(a,p),r(p,_),r(p,y),r(p,x),r(x,k),I&&I.m(x,null),r(a,b),C&&C.m(a,null),N=!0},p:function(e,n){N&&!e.limit||g(v,n.limit),n.layerIds?I?I.p(e,n):((I=P(0,n)).c(),I.m(x,null)):I&&(I.d(1),I=null),n.layerID?(C?C.p(e,n):(C=W(t,n))&&C.c(),C.i(a,null)):C&&C.o(function(){C.d(1),C=null})},i:function(t,e){N||this.m(t,e)},o:function(t){N&&(C?C.o(t):t(),N=!1)},d:function(t){t&&l(a),I&&I.d(),m(x,"change",j),C&&C.d()}}}(this,this._state),this.root._oncreate.push(function(){(function(){this.changedParams={};var t=this.get(),e=t.meta,a=t.gmxMap;this.getReportsCount();var n=[],s=[];a.layers.forEach(function(t){if(t.getGmxProperties){var a=t.getGmxProperties(),r=a.MetaProperties||{};if("vector"===a.type.toLowerCase()&&"polygon"===a.GeometryType.toLowerCase()&&!a.IsRasterCatalog&&!a.Quicklook){var o={id:a.name,title:a.title};e?(r.forest&&"true"===r.forest.Value&&n.push(o),r.quadrant&&"true"===r.quadrant.Value&&s.push(o)):(n.push(o),s.push(o))}}}),this.set({layerIds:n,quadrantIds:s,cols:[]})}).call(e),e.fire("update",{changed:n({},e._state),current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),this._lock=!0,_(this._beforecreate),_(this._oncreate),_(this._aftercreate),this._lock=!1),this._intro=!0}return a(Q.prototype,y),a(Q.prototype,R),t.App=Q,t}({});
//# sourceMappingURL=gmxForest.js.map
