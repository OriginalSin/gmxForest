var gmxForest=function(t){"use strict";function e(){}function a(t,e){for(var a in e)t[a]=e[a];return t}function n(t,e){for(var a in e)t[a]=1;return t}function s(t,e){return 0===e&&t(),function(){--e||t()}}function r(t){t()}function o(t,e){t.appendChild(e)}function l(t,e,a){t.insertBefore(e,a)}function i(t){t.parentNode.removeChild(t)}function c(t,e){for(var a=0;a<t.length;a+=1)t[a]&&t[a].d(e)}function u(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function h(){return document.createComment("")}function m(t,e,a){t.addEventListener(e,a,!1)}function v(t,e,a){t.removeEventListener(e,a,!1)}function g(t,e,a){t.setAttribute(e,a)}function f(t,e){t.data=""+e}function p(){return Object.create(null)}function _(t){t._lock=!0,x(t._beforecreate),x(t._oncreate),x(t._aftercreate),t._lock=!1}function y(t,e){t._handlers=p(),t._slots=p(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function x(t){for(;t&&t.length;)t.shift()()}var k={destroy:function(t){this.destroy=e,this.fire("destroy"),this.set=e,this._fragment.d(!1!==t),this._fragment=null,this._state={}},get:function(){return this._state},fire:function(t,e){var a=t in this._handlers&&this._handlers[t].slice();if(a)for(var n=0;n<a.length;n+=1){var s=a[n];if(!s.__calling)try{s.__calling=!0,s.call(this,e)}finally{s.__calling=!1}}},on:function(t,e){var a=this._handlers[t]||(this._handlers[t]=[]);return a.push(e),{cancel:function(){var t=a.indexOf(e);~t&&a.splice(t,1)}}},set:function(t){this._set(a({},t)),this.root._lock||_(this.root)},_recompute:e,_set:function(t){var e=this._state,n={},s=!1;for(var r in t=a(this._staged,t),this._staged={},t)this._differs(t[r],e[r])&&(n[r]=s=!0);s&&(this._state=a(a({},e),t),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(this.fire("state",{changed:n,current:this._state,previous:e}),this._fragment.p(n,this._state),this.fire("update",{changed:n,current:this._state,previous:e})))},_stage:function(t){a(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:function(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}};var b={sort:function(t){var e=this.get().sortType;this.set({sortType:"desc"===e?"asc":"desc",sortKey:t}),this.setCurrPage(1)},checkReverse:function(t){var e={},a=t.ctrlKey,n=t.target.checked;if(a||n){var s=this.get(),r=s.items,o=s.hashCols,l=s.checked,i=o.gmx_id;r.forEach(function(t){var n=t[i];a&&l[n]||(e[n]=!0)})}this.set({checked:e})},checkMe:function(t){var e=this.get().checked;e[t]?delete e[t]:e[t]=!0,this.set({checked:e})},sortMe:function(t,e,a,n){var s=a[e];return t.sort(function(t,e){var a=e[s],r=t[s];return(a<r?-1:a>r?1:0)*("desc"===n?-1:1)})},pageTo:function(t){var e=this.get().pageFrom;return this.set({pageCurr:t}),t=t<1?1:t>e?e:t,this.setCurrPage(t),t},viewItem:function(t){this.root.viewItem(t)},setCurrPage:function(t){var e=this.get(),a=e.items,n=e.hashCols,s=e.pageCurr,r=e.pagesize,o=e.sortKey,l=e.sortType,i=r*((t=t||s)-1),c=(o?this.sortMe(a,o,n,l):a).slice(i,i+r),u=a.length/r,d=Math.floor(u);this.set({tableItems:c,pageCurr:t,pageFrom:d+(u>d?1:0)})}};function N(t){var e=t.changed,a=t.current;t.previous;e.items&&a.items.length&&this.setCurrPage()}function I(t,e){var a,n,s,r,c,h,p,_,y,x,k,b,N,I=e.it[e.hashCols.gmx_id];return{c:function(){a=u("tr"),n=u("td"),s=u("input"),c=d("\r\n\t\t\t"),h=u("td"),p=u("span"),_=d(I),y=d("\r\n\t\t\t"),x=u("td"),k=u("span"),(N=u("span")).innerHTML='<svg class="svgIcon svelte-1jj6zh"><use xlink:href="#zoom-to-feature"></use></svg>',s._svelte={component:t,ctx:e},m(s,"change",C),s.checked=r=e.checked[e.it[e.hashCols.gmx_id]],g(s,"type","checkbox"),s.className="svelte-1jj6zh",n.className="c1 svelte-1jj6zh",h.className="c2 svelte-1jj6zh",k.className=b="status "+(e.it[e.hashCols.FRSTAT]>0?"checked":"")+" svelte-1jj6zh",N._svelte={component:t,ctx:e},m(N,"click",T),N.className="leaflet-gmx-iconSvg svgIcon svelte-1jj6zh",x.className="c3",a.className="item svelte-1jj6zh"},m:function(t,e){l(t,a,e),o(a,n),o(n,s),o(a,c),o(a,h),o(h,p),o(p,_),o(a,y),o(a,x),o(x,k),o(x,N)},p:function(t,a){e=a,s._svelte.ctx=e,(t.checked||t.tableItems||t.hashCols)&&r!==(r=e.checked[e.it[e.hashCols.gmx_id]])&&(s.checked=r),(t.tableItems||t.hashCols)&&I!==(I=e.it[e.hashCols.gmx_id])&&f(_,I),(t.tableItems||t.hashCols)&&b!==(b="status "+(e.it[e.hashCols.FRSTAT]>0?"checked":"")+" svelte-1jj6zh")&&(k.className=b),N._svelte.ctx=e},d:function(t){t&&i(a),v(s,"change",C),v(N,"click",T)}}}function j(t,e,a){var n=Object.create(t);return n.it=e[a],n.each_value=e,n.it_index=a,n}function C(t){var e=this._svelte,a=e.component,n=e.ctx;a.checkMe(n.it[n.hashCols.gmx_id])}function T(t){var e=this._svelte,a=e.component,n=e.ctx;a.viewItem(n.it[n.hashCols.gmx_id])}function w(t){var e=this;y(this,t),this._state=a({sortType:"desc",sortKey:"gmx_id",reverse:!1,pageCurr:1,pagesize:15,pageFrom:0,tableItems:[],items:[],hashCols:[]},t.data),this._intro=!!t.intro,this._handlers.state=[N],N.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){var a,n,s,h,p,_,y,x,k,b,N,C,T,w,F,L,D,z,S,q,R,O,M,P,V,A,E,G,H;function K(e){t.checkReverse(e)}function W(e){t.sort("gmx_id")}function B(e){t.sort("FRSTAT")}for(var U=e.tableItems,J=[],Q=0;Q<U.length;Q+=1)J[Q]=I(t,j(e,U,Q));function X(a){t.pageTo(e.pageCurr-1)}function Y(e){t.pageTo(this.value)}function Z(a){t.pageTo(e.pageCurr+1)}return{c:function(){a=u("div"),n=u("table"),s=u("tr"),h=u("th"),p=u("input"),_=d("\r\n\t\t\t"),(y=u("th")).innerHTML="<span>Id</span>",k=d("\r\n\t\t\t"),(b=u("th")).innerHTML="<span>Статус</span>",C=d("\r\n");for(var t=0;t<J.length;t+=1)J[t].c();T=d("\r\n\t\t"),w=u("tr"),F=u("td"),(L=u("button")).textContent="назад",z=d("\r\n\t\t\t\t"),S=u("span"),q=d("Стр. "),R=u("input"),O=d(" из "),M=d(e.pageFrom),P=d("\r\n\t\t\t\t"),(V=u("button")).textContent="вперед",E=d("\r\n\t\t\t\t"),(G=u("div")).innerHTML='<div class="-loading-inner"></div>',m(p,"click",K),p.checked=e.reverse,g(p,"type","checkbox"),p.value="on",p.className="svelte-1jj6zh",h.className="c1 svelte-1jj6zh",m(y,"click",W),y.className=x="c2 sorting \r\n\t\t\t\t\t"+("gmx_id"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh",m(b,"click",B),b.className=N="c3 sorting \r\n\t\t\t\t\t"+("FRSTAT"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh",s.className="head svelte-1jj6zh",m(L,"click",X),L.disabled=D=1===e.pageCurr,m(R,"change",Y),g(R,"type","number"),R.value=e.pageCurr,R.className="svelte-1jj6zh",S.className="pageInfo svelte-1jj6zh",m(V,"click",Z),V.disabled=A=e.pageFrom===e.pageCurr,G.className="-loading",F.colSpan="3",F.className="svelte-1jj6zh",w.className="pagination svelte-1jj6zh",n.className="table svelte-1jj6zh",a.className="tableContect svelte-1jj6zh"},m:function(t,e){l(t,a,e),o(a,n),o(n,s),o(s,h),o(h,p),o(s,_),o(s,y),o(s,k),o(s,b),o(n,C);for(var r=0;r<J.length;r+=1)J[r].m(n,null);o(n,T),o(n,w),o(w,F),o(F,L),o(F,z),o(F,S),o(S,q),o(S,R),o(S,O),o(S,M),o(F,P),o(F,V),o(F,E),o(F,G),H=!0},p:function(a,s){if(e=s,a.reverse&&(p.checked=e.reverse),(a.sortKey||a.sortType)&&x!==(x="c2 sorting \r\n\t\t\t\t\t"+("gmx_id"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh")&&(y.className=x),(a.sortKey||a.sortType)&&N!==(N="c3 sorting \r\n\t\t\t\t\t"+("FRSTAT"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh")&&(b.className=N),a.checked||a.tableItems||a.hashCols){U=e.tableItems;for(var r=0;r<U.length;r+=1){var o=j(e,U,r);J[r]?J[r].p(a,o):(J[r]=I(t,o),J[r].c(),J[r].m(n,T))}for(;r<J.length;r+=1)J[r].d(1);J.length=U.length}a.pageCurr&&D!==(D=1===e.pageCurr)&&(L.disabled=D),a.pageCurr&&(R.value=e.pageCurr),a.pageFrom&&f(M,e.pageFrom),(a.pageFrom||a.pageCurr)&&A!==(A=e.pageFrom===e.pageCurr)&&(V.disabled=A)},i:function(t,e){H||this.m(t,e)},o:r,d:function(t){t&&i(a),v(p,"click",K),v(y,"click",W),v(b,"click",B),c(J,t),v(L,"click",X),v(R,"change",Y),v(V,"click",Z)}}}(this,this._state),this.root._oncreate.push(function(){e.fire("update",{changed:n({},e._state),current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),_(this)),this._intro=!0}a(w.prototype,k),a(w.prototype,b);function F(t){var e=t.changed,a=t.current;t.previous;if(e.clicked)if(a.clicked){var n=this.get().cols;this.setSelection(n[0])}else{var s=this.get().value;this.setValue(s)}}function D(t,e){var a,n,s,r,c=e.it;return{c:function(){a=u("option"),n=d(c),a.__value=s=e.it,a.value=a.__value,a.selected=r=e.colName===e.it},m:function(t,e){l(t,a,e),o(a,n)},p:function(t,e){t.cols&&c!==(c=e.it)&&f(n,c),t.cols&&s!==(s=e.it)&&(a.__value=s),a.value=a.__value,(t.colName||t.cols)&&r!==(r=e.colName===e.it)&&(a.selected=r)},d:function(t){t&&i(a)}}}function z(t,e){for(var a,n=e.cols,s=[],r=0;r<n.length;r+=1)s[r]=D(0,q(e,n,r));function o(e){t.setSelection(this.options[this.selectedIndex].value)}return{c:function(){a=u("select");for(var t=0;t<s.length;t+=1)s[t].c();m(a,"change",o),a.name=e.key,a.className="gmx-sidebar-select-with-addon svelte-1amu9hw"},m:function(t,e){l(t,a,e);for(var n=0;n<s.length;n+=1)s[n].m(a,null)},p:function(t,e){if(t.cols||t.colName){n=e.cols;for(var r=0;r<n.length;r+=1){var o=q(e,n,r);s[r]?s[r].p(t,o):(s[r]=D(0,o),s[r].c(),s[r].m(a,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}t.key&&(a.name=e.key)},d:function(t){t&&i(a),c(s,t),v(a,"change",o)}}}function S(t,e){var a;function n(e){t.setValue(e.target.value)}return{c:function(){m(a=u("input"),"change",n),g(a,"type","text"),a.className="gmx-sidebar-input-with-addon svelte-1amu9hw",a.name=e.key,a.value=e.value},m:function(t,e){l(t,a,e)},p:function(t,e){t.key&&(a.name=e.key),t.value&&(a.value=e.value)},d:function(t){t&&i(a),v(a,"change",n)}}}function q(t,e,a){var n=Object.create(t);return n.it=e[a],n.each_value=e,n.it_index=a,n}function R(t){var e=this;y(this,t),this._state=a({title:"",value:"",colName:"",clicked:!1,cols:[]},t.data),this._intro=!!t.intro,this._handlers.state=[F],F.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){var a,n,s,c,h,g,p,_,y;function x(t){return t.clicked?z:S}var k=x(e),b=k(t,e);function N(a){t.set({clicked:!e.clicked})}return{c:function(){a=u("div"),n=u("div"),s=d(e.title),c=d("\r\n\t"),h=u("div"),g=u("div"),b.c(),p=d("\r\n\t\t\t"),_=u("button"),n.className="gmx-sidebar-label svelte-1amu9hw",m(_,"click",N),_.className="gmx-addon-button svelte-1amu9hw",_.title="выбрать из таблицы атрибутов",a.className="gmx-sidebar-labeled-block svelte-1amu9hw"},m:function(t,e){l(t,a,e),o(a,n),o(n,s),o(a,c),o(a,h),o(h,g),b.m(g,null),o(g,p),o(g,_),y=!0},p:function(a,n){e=n,a.title&&f(s,e.title),k===(k=x(e))&&b?b.p(a,e):(b.d(1),(b=k(t,e)).c(),b.m(g,p))},i:function(t,e){y||this.m(t,e)},o:r,d:function(t){t&&i(a),b.d(),v(_,"click",N)}}}(this,this._state),this.root._oncreate.push(function(){(function(){var t=this.get().key,e=this.root.get().params[t];void 0===e.title&&(e.title=e.value),this.set(e)}).call(e),e.fire("update",{changed:n({},e._state),current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),_(this)),this._intro=!0}a(R.prototype,k),a(R.prototype,{setSelection:function(t){var e=this.get().key;this.root.setField(e,{value:"",field:t})},setValue:function(t){var e=this.get().key;this.root.setField(e,{value:t,field:""})}});var O=window.serverBase||"//maps.kosmosnimki.ru/";var M={viewItem:function(t){for(var e=this.get(),a=e.map,n=e.layerItems,s=e.hashCols,r=0,o=n.length;r<o;r++){var l=n[r];if(t===l[s.gmx_id]){var i=l[s.geomixergeojson],c=L.gmxUtil.getGeometryBounds(i),u=L.latLngBounds([[c.min.y,c.min.x],[c.max.y,c.max.x]]);a.fitBounds(u);break}}},sendReport:function(){var t=this,e=this.get(),a=e.checked,n=e.layerItems,s=e.hashCols,r=e.params,o=e.format,l=e.layerID,i=[],c=[],u=[];return e.gmxMap.layers.forEach(function(t){if(t.getGmxProperties&&t._map){var e=t.getGmxProperties(),a=e.MetaProperties||{},n={layerId:e.name,type:"оптическая"};if(e.Temporal){var s=t.getDateInterval();s.beginDate&&(n.beginDate=s.beginDate.getTime()/1e3),s.endDate&&(n.endDate=s.endDate.getTime()/1e3)}a.type&&(n.type=a.type.Value),a.system&&(n.system=a.system.Value),a.resolution&&(n.resolution=a.resolution.Value),u.push(n)}}),n.forEach(function(e){var n=e[s.gmx_id];if(a[n]){var l={featureID:n,format:o};for(var d in r){var h=r[d],m=t.changedParams[d]||{};l[d]="string"==typeof m?m:m.field?e[s[m.field]]:m.value||h.value}l.satLayers=u,i.push(l),c.push({action:"update",id:n,properties:{FRSTAT:2}})}}),this.set({report:!0}),fetch(O+"Plugins/ForestReport/ForestReportImage",{method:"post",headers:{"Content-type":"application/x-www-form-urlencoded"},body:L.gmxUtil.getFormData({WrapStyle:"None",groupRequest:i}),mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(e){"ok"===e.Status&&t.chkTask(e.Result.TaskID).then(function(e){if("ok"===e.Status){var a=e.Result.Result.downloadFile;a.split("name=")[1];window.open(O+a,"_self"),t.modifyVectorObjects(l,c),t.set({report:!1})}}).catch(function(t){return console.log(t)})}).catch(function(t){return console.log(t)})},chkTask:function(t){return new Promise(function(e,a){var n=setInterval(function(){fetch(O+"AsyncTask.ashx?WrapStyle=None&TaskID="+t,{mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(t){var s=t.Result,r=s.Completed;s.ErrorInfo?(clearInterval(n),a(t)):r&&(clearInterval(n),e(t))})},2e3)})},modifyVectorObjects:function(t,e){var a={WrapStyle:"None",LayerName:t,Objects:JSON.stringify(e)};return fetch(O+"VectorLayer/ModifyVectorObjects.ashx?"+L.gmxUtil.getFormData(a),{mode:"cors",credentials:"include",headers:{Accept:"application/json"}}).then(function(t){return t.json()}).catch(function(t){return console.log(t)})},selectFeaturesWithDrawing:function(t,e){var a={WrapStyle:"None",layer:t,columns:'[{"Value":"[gmx_id]"}]',page:0,query:"STIntersects([gmx_geometry], GeometryFromGeoJson('"+JSON.stringify(e)+"', 4326))"};return fetch(O+"VectorLayer/Search.ashx?"+L.gmxUtil.getFormData(a),{mode:"cors",credentials:"include",headers:{Accept:"application/json"}}).then(function(t){return t.json()}).catch(function(t){return console.log(t)})},startDrawing:function(t){var e=this,a=this.get(),n=a.map,s=a.drawstart,r=a.layerID,o=a.checked;this.set({drawstart:!s}),s||(n.gmxDrawing.clear(),n.gmxDrawing.create("Polygon"),n.gmxDrawing.on("drawstop",function(t){e.set({drawstart:!1}),e.selectFeaturesWithDrawing(r,t.object.toGeoJSON().geometry).then(function(t){if("ok"===t.Status&&t.Result){var a=t.Result.values.reduce(function(t,e){return t[e]=!0,t},{});e.root.set({checked:L.extend(a,o)})}})},this),n._gmxEventsManager._drawstart=!0)},setField:function(t,e){this.changedParams[t]=e},setNodeField:function(t,e){var a,n=t.options?t.options[t.selectedIndex].value:t.value;this.setField(t.name,n),e&&this.set(((a={})[t.name]=n,a))},colsToHash:function(t){return t.reduce(function(t,e,a){return t[e]=a,t},{})},loadFeatures:function(t){var e=this;return fetch(O+"VectorLayer/Search.ashx?layer="+t+"&geometry=true&out_cs=EPSG:4326&WrapStyle=None",{mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(t){if("ok"===t.Status){var a=t.Result.fields;e.set({cols:a,hashCols:e.colsToHash(a),layerItems:t.Result.values})}}).catch(function(t){return console.log(t)})},getReportsCount:function(){var t=this;return fetch(O+"plugins/forestreport/rest/GetCurrentUserInfo?WrapStyle=None",{mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(e){if("ok"===e.Status){var a=e.Result.limit-e.Result.used;t.set({limit:a>0?a:0})}}).catch(function(t){return console.log(t)})},styleHook:function(t){return this.get().checked[t.id]?{strokeStyle:"#00ffff"}:{}}};function P(t){var e=t.changed,a=t.current;t.previous;if(e.layerID&&a.layerID){var n=this.get(),s=n.gmxMap;n.checked;this.currentLayer=s.layersByID[a.layerID],this.currentLayer&&this.currentLayer.setStyleHook(this.styleHook.bind(this)),this.loadFeatures(a.layerID)}e.checked&&this.currentLayer&&this.currentLayer.repaint()}function V(t,e){var a,n,s,r,c=e.it.title;return{c:function(){a=u("option"),n=d(c),a.__value=s=e.it.id,a.value=a.__value,a.selected=r=e.layerID===e.it.id,a.className="svelte-gt11xl"},m:function(t,e){l(t,a,e),o(a,n)},p:function(t,e){t.layerIds&&c!==(c=e.it.title)&&f(n,c),t.layerIds&&s!==(s=e.it.id)&&(a.__value=s),a.value=a.__value,(t.layerID||t.layerIds)&&r!==(r=e.layerID===e.it.id)&&(a.selected=r)},d:function(t){t&&i(a)}}}function A(t,e){for(var a,n=e.layerIds,s=[],r=0;r<n.length;r+=1)s[r]=V(0,J(e,n,r));return{c:function(){for(var t=0;t<s.length;t+=1)s[t].c();a=h()},m:function(t,e){for(var n=0;n<s.length;n+=1)s[n].m(t,e);l(t,a,e)},p:function(t,e){if(t.layerIds||t.layerID){n=e.layerIds;for(var r=0;r<n.length;r+=1){var o=J(e,n,r);s[r]?s[r].p(t,o):(s[r]=V(0,o),s[r].c(),s[r].m(a.parentNode,a))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d:function(t){c(s,t),t&&i(a)}}}function E(t,e){var a,n,s,r=e.it;return{c:function(){a=u("option"),n=d(r),a.__value=s=e.it,a.value=a.__value,a.className="svelte-gt11xl"},m:function(t,e){l(t,a,e),o(a,n)},p:function(t,e){t.params&&r!==(r=e.it)&&f(n,r),t.params&&s!==(s=e.it)&&(a.__value=s),a.value=a.__value},d:function(t){t&&i(a)}}}function G(t,e){var a,n,r,c={key:"fellingForm",cols:e.cols},h=new R({root:t.root,store:t.store,data:c}),m={key:"fellingType",cols:e.cols},v=new R({root:t.root,store:t.store,data:m});return{c:function(){a=u("div"),h._fragment.c(),n=d("\r\n\t\t\t\t\t\t"),v._fragment.c()},m:function(t,e){l(t,a,e),h._mount(a,null),o(a,n),v._mount(a,null),r=!0},p:function(t,e){var a={};t.cols&&(a.cols=e.cols),h._set(a);var n={};t.cols&&(n.cols=e.cols),v._set(n)},i:function(t,e){r||this.m(t,e)},o:function(t){r&&(t=s(t,2),h&&h._fragment.o(t),v&&v._fragment.o(t),r=!1)},d:function(t){t&&i(a),h.destroy(),v.destroy()}}}function H(t,e){var a,n,s,r,c=e.it.title;return{c:function(){a=u("option"),n=d(c),a.__value=s=e.it.id,a.value=a.__value,a.selected=r=e.quadrantLayerId===e.it.id,a.className="svelte-gt11xl"},m:function(t,e){l(t,a,e),o(a,n)},p:function(t,e){t.quadrantIds&&c!==(c=e.it.title)&&f(n,c),t.quadrantIds&&s!==(s=e.it.id)&&(a.__value=s),a.value=a.__value,(t.quadrantLayerId||t.quadrantIds)&&r!==(r=e.quadrantLayerId===e.it.id)&&(a.selected=r)},d:function(t){t&&i(a)}}}function K(t,e){for(var a,n=e.quadrantIds,s=[],r=0;r<n.length;r+=1)s[r]=H(0,X(e,n,r));return{c:function(){for(var t=0;t<s.length;t+=1)s[t].c();a=h()},m:function(t,e){for(var n=0;n<s.length;n+=1)s[n].m(t,e);l(t,a,e)},p:function(t,e){if(t.quadrantIds||t.quadrantLayerId){n=e.quadrantIds;for(var r=0;r<n.length;r+=1){var o=X(e,n,r);s[r]?s[r].p(t,o):(s[r]=H(0,o),s[r].c(),s[r].m(a.parentNode,a))}for(;r<s.length;r+=1)s[r].d(1);s.length=n.length}},d:function(t){c(s,t),t&&i(a)}}}function W(t,a){var n;return{c:function(){(n=u("button")).innerHTML='<div class="lds-ellipsis svelte-gt11xl"><div class="svelte-gt11xl"></div><div class="svelte-gt11xl"></div><div class="svelte-gt11xl"></div><div class="svelte-gt11xl"></div></div>',n.className="gmx-sidebar-button-disabled svelte-gt11xl"},m:function(t,e){l(t,n,e)},p:e,d:function(t){t&&i(n)}}}function B(t,e){var a,n;function s(e){t.sendReport()}return{c:function(){(a=u("button")).textContent="Создать отчеты",m(a,"click",s),a.className=n="gmx-sidebar-button"+(e.Object.keys(e.checked).length?"":"-disabled")+" svelte-gt11xl"},m:function(t,e){l(t,a,e)},p:function(t,e){(t.Object||t.checked)&&n!==(n="gmx-sidebar-button"+(e.Object.keys(e.checked).length?"":"-disabled")+" svelte-gt11xl")&&(a.className=n)},d:function(t){t&&i(a),v(a,"click",s)}}}function U(t,e){for(var a,n,r,h,p,_,y,x,k,b,N,I,j,C,T,F,L,D,z,S,q,O,M,P,V,A,H,U,J,X,Y,Z,$,tt,et,at,nt,st,rt,ot,lt,it,ct,ut,dt,ht,mt,vt,gt,ft,pt,_t,yt,xt,kt,bt,Nt,It,jt,Ct,Tt,wt,Ft,Lt,Dt,zt,St,qt,Rt,Ot,Mt,Pt,Vt,At,Et,Gt,Ht,Kt,Wt,Bt,Ut,Jt,Qt,Xt,Yt=e.params.reportType.title,Zt=e.params.organizationName.title||e.params.organizationName.value,$t=e.params.inn.title||e.params.inn.value,te=e.params.reportType.title,ee=e.params.quadrantLayerId.title||e.params.quadrantLayerId.value,ae=e.drawstart?"Полигон рисуется":"Выделите участки полигоном",ne=e.Object.keys(e.checked).length,se=e.layerItems.length,re={},oe=e.params.reportType.options,le=[],ie=0;ie<oe.length;ie+=1)le[ie]=E(0,Q(e,oe,ie));function ce(e){t.setNodeField(this,!0)}var ue="о восстановлении лесов"!==e.reportType&&G(t,e);function de(e){t.setNodeField(this)}function he(e){t.setNodeField(this)}var me={key:"region",cols:e.cols},ve=new R({root:t.root,store:t.store,data:me}),ge={key:"forestry",cols:e.cols},fe=new R({root:t.root,store:t.store,data:ge}),pe={key:"sectionForestry",cols:e.cols},_e=new R({root:t.root,store:t.store,data:pe}),ye={key:"quadrant",cols:e.cols},xe=new R({root:t.root,store:t.store,data:ye}),ke={key:"stratum",cols:e.cols},be=new R({root:t.root,store:t.store,data:ke}),Ne={key:"site",cols:e.cols},Ie=new R({root:t.root,store:t.store,data:Ne}),je={key:"recoveryEventType",cols:e.cols},Ce=new R({root:t.root,store:t.store,data:je}),Te={key:"siteArea",cols:e.cols},we=new R({root:t.root,store:t.store,data:Te});function Fe(e){t.setNodeField(this,!0)}var Le=e.quadrantIds&&K(0,e);function De(e){t.setNodeField(this,!0)}function ze(e){t.startDrawing(e)}var Se={items:e.layerItems,hashCols:e.hashCols};void 0!==e.checked&&(Se.checked=e.checked,re.checked=!0);var qe=new w({root:t.root,store:t.store,data:Se,_bind:function(e,a){var n={};!re.checked&&e.checked&&(n.checked=a.checked),t._set(n),re={}}});function Re(t){return t.report?W:B}t.root._beforecreate.push(function(){qe._bind({checked:1},qe.get())});var Oe=Re(e),Me=Oe(t,e);return{c:function(){a=u("div"),(n=u("div")).textContent="Ввод информации",r=d("\r\n\t\t\t"),h=u("div"),p=u("div"),_=u("div"),y=u("div"),x=d(Yt),k=d("\r\n\t\t\t\t\t\t"),b=u("select");for(var t=0;t<le.length;t+=1)le[t].c();N=d("\r\n"),ue&&ue.c(),I=d("\r\n\t\t\t\t\t"),j=u("div"),C=u("div"),T=d(Zt),F=d("\r\n\t\t\t\t\t\t"),L=u("input"),z=d("\r\n\t\t\t\t\t"),S=u("div"),q=u("div"),O=d($t),M=d("\r\n\t\t\t\t\t\t"),P=u("input"),A=d("\r\n\r\n\t\t\t\t\t"),ve._fragment.c(),H=d("\r\n\t\t\t\t\t"),fe._fragment.c(),U=d("\r\n\t\t\t\t\t"),_e._fragment.c(),J=d("\r\n\t\t\t\t\t"),xe._fragment.c(),X=d("\r\n\t\t\t\t\t"),be._fragment.c(),Y=d("\r\n\t\t\t\t\t"),Ie._fragment.c(),Z=d("\r\n\t\t\t\t\t"),Ce._fragment.c(),$=d("\r\n\t\t\t\t\t"),we._fragment.c(),tt=d("\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t\t"),et=u("div"),at=u("div"),nt=d(te),st=d("\r\n\t\t\t\t\t\t"),rt=u("select"),ot=u("option"),lt=d("1:5000"),it=u("option"),ct=d("1:10000"),ut=u("option"),dt=d("1:15000"),ht=u("option"),mt=d("1:20000"),vt=u("option"),gt=d("1:25000"),ft=u("option"),pt=d("1:30000"),_t=u("option"),yt=d("1:35000"),xt=u("option"),kt=d("1:40000"),bt=u("option"),Nt=d("1:45000"),It=u("option"),jt=d("1:50000"),Ct=d("\r\n\t\t\t\t\t"),Tt=u("div"),wt=u("div"),Ft=d(ee),Lt=d("\r\n\t\t\t\t\t\t"),Dt=u("select"),zt=u("option"),Le&&Le.c(),St=d("\r\n\t\t\t"),(qt=u("div")).textContent="Список объектов",Rt=d("\r\n\t\t\t"),Ot=u("div"),Mt=u("div"),Pt=u("div"),Vt=u("button"),At=d(ae),Et=d("\r\n\t\t\t\t\t"),Gt=u("div"),Ht=d("Выделено: "),Kt=d(ne),Wt=d(" / "),Bt=d(se),Ut=d("\r\n\t\t\t\t\t"),qe._fragment.c(),Jt=d("\r\n\t\t\t"),Qt=u("div"),Me.c(),n.className="gmx-sidebar-label-medium svelte-gt11xl",y.className="gmx-sidebar-label svelte-gt11xl",m(b,"change",ce),b.name="reportType",b.className="gmx-sidebar-select-large svelte-gt11xl",_.className="gmx-sidebar-labeled-block svelte-gt11xl",C.className="gmx-sidebar-label-small svelte-gt11xl",m(L,"change",de),L.name="organizationName",L.value=D=e.params.organizationName.value,g(L,"type","text"),L.className="gmx-sidebar-input-large svelte-gt11xl",j.className="gmx-sidebar-labeled-block svelte-gt11xl",q.className="gmx-sidebar-label-small svelte-gt11xl",m(P,"change",he),P.name="inn",P.value=V=e.params.inn.value,g(P,"type","text"),P.className="gmx-sidebar-input-large svelte-gt11xl",S.className="gmx-sidebar-labeled-block svelte-gt11xl",at.className="gmx-sidebar-label svelte-gt11xl",ot.__value="5000",ot.value=ot.__value,ot.className="svelte-gt11xl",it.__value="10000",it.value=it.__value,it.className="svelte-gt11xl",ut.__value="15000",ut.value=ut.__value,ut.className="svelte-gt11xl",ht.__value="20000",ht.value=ht.__value,ht.className="svelte-gt11xl",vt.__value="25000",vt.value=vt.__value,vt.className="svelte-gt11xl",ft.__value="30000",ft.value=ft.__value,ft.className="svelte-gt11xl",_t.__value="35000",_t.value=_t.__value,_t.className="svelte-gt11xl",xt.__value="40000",xt.value=xt.__value,xt.className="svelte-gt11xl",bt.__value="45000",bt.value=bt.__value,bt.className="svelte-gt11xl",It.__value="50000",It.value=It.__value,It.className="svelte-gt11xl",m(rt,"change",Fe),rt.name="scale",rt.className="gmx-sidebar-select-large svelte-gt11xl",et.className="gmx-sidebar-labeled-block svelte-gt11xl",wt.className="gmx-sidebar-label svelte-gt11xl",zt.__value="",zt.value=zt.__value,zt.className="svelte-gt11xl",m(Dt,"change",De),Dt.name="quadrantLayerId",Dt.className="gmx-sidebar-select-large svelte-gt11xl",Tt.className="gmx-sidebar-labeled-block svelte-gt11xl",qt.className="gmx-sidebar-label-medium svelte-gt11xl",m(Vt,"click",ze),Vt.className="gmx-sidebar-button svelte-gt11xl",Pt.className="gmx-geometry-select-container svelte-gt11xl",Gt.className="gmx-sidebar-label-medium svelte-gt11xl",Ot.className="forest-features-block svelte-gt11xl",Qt.className="gmx-button-container svelte-gt11xl",a.className="leftContent forest-plugin-content svelte-gt11xl"},m:function(t,e){l(t,a,e),o(a,n),o(a,r),o(a,h),o(h,p),o(p,_),o(_,y),o(y,x),o(_,k),o(_,b);for(var s=0;s<le.length;s+=1)le[s].m(b,null);o(p,N),ue&&ue.m(p,null),o(p,I),o(p,j),o(j,C),o(C,T),o(j,F),o(j,L),o(p,z),o(p,S),o(S,q),o(q,O),o(S,M),o(S,P),o(p,A),ve._mount(p,null),o(p,H),fe._mount(p,null),o(p,U),_e._mount(p,null),o(p,J),xe._mount(p,null),o(p,X),be._mount(p,null),o(p,Y),Ie._mount(p,null),o(p,Z),Ce._mount(p,null),o(p,$),we._mount(p,null),o(p,tt),o(p,et),o(et,at),o(at,nt),o(et,st),o(et,rt),o(rt,ot),o(ot,lt),o(rt,it),o(it,ct),o(rt,ut),o(ut,dt),o(rt,ht),o(ht,mt),o(rt,vt),o(vt,gt),o(rt,ft),o(ft,pt),o(rt,_t),o(_t,yt),o(rt,xt),o(xt,kt),o(rt,bt),o(bt,Nt),o(rt,It),o(It,jt),o(p,Ct),o(p,Tt),o(Tt,wt),o(wt,Ft),o(Tt,Lt),o(Tt,Dt),o(Dt,zt),Le&&Le.m(Dt,null),o(a,St),o(a,qt),o(a,Rt),o(a,Ot),o(Ot,Mt),o(Mt,Pt),o(Pt,Vt),o(Vt,At),o(Mt,Et),o(Mt,Gt),o(Gt,Ht),o(Gt,Kt),o(Gt,Wt),o(Gt,Bt),o(Mt,Ut),qe._mount(Mt,null),o(a,Jt),o(a,Qt),Me.m(Qt,null),Xt=!0},p:function(a,n){if(e=n,Xt&&!a.params||Yt===(Yt=e.params.reportType.title)||f(x,Yt),a.params){oe=e.params.reportType.options;for(var s=0;s<oe.length;s+=1){var r=Q(e,oe,s);le[s]?le[s].p(a,r):(le[s]=E(0,r),le[s].c(),le[s].m(b,null))}for(;s<le.length;s+=1)le[s].d(1);le.length=oe.length}"о восстановлении лесов"!==e.reportType?(ue?ue.p(a,e):(ue=G(t,e))&&ue.c(),ue.i(p,I)):ue&&ue.o(function(){ue.d(1),ue=null}),Xt&&!a.params||Zt===(Zt=e.params.organizationName.title||e.params.organizationName.value)||f(T,Zt),Xt&&!a.params||D===(D=e.params.organizationName.value)||(L.value=D),Xt&&!a.params||$t===($t=e.params.inn.title||e.params.inn.value)||f(O,$t),Xt&&!a.params||V===(V=e.params.inn.value)||(P.value=V);var o={};a.cols&&(o.cols=e.cols),ve._set(o);var l={};a.cols&&(l.cols=e.cols),fe._set(l);var i={};a.cols&&(i.cols=e.cols),_e._set(i);var c={};a.cols&&(c.cols=e.cols),xe._set(c);var u={};a.cols&&(u.cols=e.cols),be._set(u);var d={};a.cols&&(d.cols=e.cols),Ie._set(d);var h={};a.cols&&(h.cols=e.cols),Ce._set(h);var m={};a.cols&&(m.cols=e.cols),we._set(m),Xt&&!a.params||te===(te=e.params.reportType.title)||f(nt,te),Xt&&!a.params||ee===(ee=e.params.quadrantLayerId.title||e.params.quadrantLayerId.value)||f(Ft,ee),e.quadrantIds?Le?Le.p(a,e):((Le=K(0,e)).c(),Le.m(Dt,null)):Le&&(Le.d(1),Le=null),Xt&&!a.drawstart||ae===(ae=e.drawstart?"Полигон рисуется":"Выделите участки полигоном")||f(At,ae),Xt&&!a.Object&&!a.checked||ne===(ne=e.Object.keys(e.checked).length)||f(Kt,ne),Xt&&!a.layerItems||se===(se=e.layerItems.length)||f(Bt,se);var v={};a.layerItems&&(v.items=e.layerItems),a.hashCols&&(v.hashCols=e.hashCols),!re.checked&&a.checked&&(v.checked=e.checked,re.checked=void 0!==e.checked),qe._set(v),re={},Oe===(Oe=Re(e))&&Me?Me.p(a,e):(Me.d(1),(Me=Oe(t,e)).c(),Me.m(Qt,null))},i:function(t,e){Xt||this.m(t,e)},o:function(t){Xt&&(t=s(t,10),ue?ue.o(t):t(),ve&&ve._fragment.o(t),fe&&fe._fragment.o(t),_e&&_e._fragment.o(t),xe&&xe._fragment.o(t),be&&be._fragment.o(t),Ie&&Ie._fragment.o(t),Ce&&Ce._fragment.o(t),we&&we._fragment.o(t),qe&&qe._fragment.o(t),Xt=!1)},d:function(t){t&&i(a),c(le,t),v(b,"change",ce),ue&&ue.d(),v(L,"change",de),v(P,"change",he),ve.destroy(),fe.destroy(),_e.destroy(),xe.destroy(),be.destroy(),Ie.destroy(),Ce.destroy(),we.destroy(),v(rt,"change",Fe),Le&&Le.d(),v(Dt,"change",De),v(Vt,"click",ze),qe.destroy(),Me.d()}}}function J(t,e,a){var n=Object.create(t);return n.it=e[a],n.each_value=e,n.it_index=a,n}function Q(t,e,a){var n=Object.create(t);return n.it=e[a],n.each_value_1=e,n.it_index_1=a,n}function X(t,e,a){var n=Object.create(t);return n.it=e[a],n.each_value_2=e,n.it_index_2=a,n}function Y(t){var e=this;y(this,t),this._state=a(a({Object:Object},{params:{layerID:{value:"",title:"Выбор слоя"},quadrantLayerId:{value:"",title:"Слой квартальной сети"},reportType:{value:"об использовании лесов",options:["об использовании лесов","о восстановлении лесов"],title:"Тип отчета"},organizationName:{value:"Наименование организации"},inn:{value:"1234567890",title:"ИНН"},region:{value:"Субъект",title:"Субъект Российской Федерации"},forestry:{value:"Лесничество"},sectionForestry:{value:"Участковое лесничество"},quadrant:{value:"Квартал"},stratum:{value:"Выдел"},fellingForm:{value:"",title:"Форма рубки"},fellingType:{value:"",title:"Тип рубки"},recoveryEventType:{value:"",title:"Тип мероприятия"},siteArea:{value:"Площадь"},scale:{value:"Масштаб"},site:{value:"Делянка"}},layerItems:[],format:2,limit:0,report:!1,drawstart:!1,layerID:"",quadrantLayerId:"",reportType:"",checked:{},layerIds:[],quadrantIds:[],hashCols:{},cols:[]}),t.data),this._intro=!!t.intro,this._handlers.state=[P],P.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){var a,n,s,r,c,h,g,p,_,y,x,k,b,N,I=e.layerIds&&A(0,e);function j(e){t.setNodeField(this,!0)}var C=e.layerID&&U(t,e);return{c:function(){a=u("div"),(n=u("div")).textContent="Отчет об использовании лесов",s=d("\r\n\t"),r=u("div"),c=d("Лимит отчетов: "),h=d(e.limit),g=d("\r\n\t"),p=u("div"),(_=u("span")).textContent="Выбор слоя",y=d("\r\n\t\t"),x=u("select"),k=u("option"),I&&I.c(),b=d("\r\n"),C&&C.c(),n.className="forest-plugin-header svelte-gt11xl",r.className="forest-plugin-header svelte-gt11xl",_.className="gmx-select-layer-container__label svelte-gt11xl",k.__value="",k.value=k.__value,k.className="svelte-gt11xl",m(x,"change",j),x.name="layerID",x.className="gmx-sidebar-select-medium svelte-gt11xl",p.className="gmx-select-layer-container svelte-gt11xl",a.className="forest-plugin-container svelte-gt11xl"},m:function(t,e){l(t,a,e),o(a,n),o(a,s),o(a,r),o(r,c),o(r,h),o(a,g),o(a,p),o(p,_),o(p,y),o(p,x),o(x,k),I&&I.m(x,null),o(a,b),C&&C.m(a,null),N=!0},p:function(e,n){N&&!e.limit||f(h,n.limit),n.layerIds?I?I.p(e,n):((I=A(0,n)).c(),I.m(x,null)):I&&(I.d(1),I=null),n.layerID?(C?C.p(e,n):(C=U(t,n))&&C.c(),C.i(a,null)):C&&C.o(function(){C.d(1),C=null})},i:function(t,e){N||this.m(t,e)},o:function(t){N&&(C?C.o(t):t(),N=!1)},d:function(t){t&&i(a),I&&I.d(),v(x,"change",j),C&&C.d()}}}(this,this._state),this.root._oncreate.push(function(){(function(){this.changedParams={};var t=this.get(),e=t.meta,a=t.gmxMap;this.getReportsCount();var n=[],s=[];a.layers.forEach(function(t){if(t.getGmxProperties){var a=t.getGmxProperties(),r=a.MetaProperties||{};if("vector"===a.type.toLowerCase()&&"polygon"===a.GeometryType.toLowerCase()&&!a.IsRasterCatalog&&!a.Quicklook){var o={id:a.name,title:a.title};e?(r.forest&&"true"===r.forest.Value&&n.push(o),r.quadrant&&"true"===r.quadrant.Value&&s.push(o)):(n.push(o),s.push(o))}}}),this.set({layerIds:n,quadrantIds:s,cols:[]})}).call(e),e.fire("update",{changed:n({},e._state),current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),_(this)),this._intro=!0}return a(Y.prototype,k),a(Y.prototype,M),t.App=Y,t}({});
//# sourceMappingURL=gmxForest.js.map
